<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Orden de Trabajo - CICLOPIT / Teletón</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  :root {
    --bg: #f8f8f8;
    --card: #ffffff;
    --bdr: #cccccc;
    --muted: #f0f0f0;
    --txt: #222;
    --accent: #e91e63;
    --accent-2: #c2185b;
    --danger: #d32f2f;
    --danger-2: #b71c1c;
  }
  body { font-family: Arial, sans-serif; margin: 20px; background: var(--bg); color: var(--txt); }
  .container { max-width: 1100px; margin: auto; background: var(--card); padding: 20px; border-radius: 10px; box-shadow: 0 0 8px rgba(0,0,0,0.2); }
  h2 { text-align: center; margin: 0 0 12px 0; text-transform: uppercase; font-size: 18px; }
  h4 { margin: 0 0 12px 0; }
  .section { margin-bottom: 16px; }
  .section h3 { font-size: 15px; margin: 0 0 8px 0; }
  .title-inline { font-size:15px; margin:0 0 8px 0; display:flex; align-items:center; gap:12px; flex-wrap: wrap; }
  .title-inline .nficha input { width:130px; padding:4px; }

  table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
  th, td { border: 1px solid var(--bdr); padding: 6px; text-align: left; vertical-align: top; }
  th { background: var(--muted); }

  input[readonly], textarea[readonly] { background: #f9f9f9; border: none; color: #333; width: 100%; font-size: 13px; }
  textarea { width: 100%; resize: vertical; min-height: 60px; }

  /* Firma */
  .firma-wrap { display: grid; gap: 8px; }
  .firma-box {
    width: 100%;
    height: 160px;
    border: 1px solid #999;
    border-radius: 6px;
    background: #fff;
    touch-action: none;
  }
  .firma-actions { display:flex; gap:8px; }
  .btn-sm {
    background: var(--muted);
    border: 1px solid var(--bdr);
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
  }
  .btn-sm:hover { filter: brightness(0.98); }

  .badge {
    display:inline-block;
    padding: 4px 8px;
    border: 1px solid var(--bdr);
    border-radius: 6px;
    background: #fafafa;
    font-size: 12px;
  }

  .btns { display:flex; gap:10px; margin-top:18px; }
  .btn {
    flex:1; border:none; padding:12px; font-size:16px; cursor:pointer; border-radius:8px; color:#fff;
  }
  .btn-print { background:var(--accent); }
  .btn-print:hover { background:var(--accent-2); }
  .btn-close { background:var(--danger); }
  .btn-close:hover { background:var(--danger-2); }

  small { font-size:11px; color:#555; display:block; margin-top:8px; line-height: 1.35; }

  /* IMPRESIÓN: intentar forzar todo en 1 página A4 */
  @media print {
    @page { size: A4; margin: 8mm; }
    html, body { margin:0 !important; padding:0 !important; }
    .container { box-shadow:none; border-radius:0; padding: 6mm; }
    .btn, .btn-sm { display:none !important; }
    .firma-box { border: 1px solid #000; height: 110px; } /* firma más compacta al imprimir */
    .badge { border: 1px solid #000; }

    /* compactación general */
    * { font-size: 11px; }
    h2 { font-size: 14px; margin-bottom: 6px; }
    h3 { font-size: 12px; margin-bottom: 4px; }
    h4 { font-size: 12px; margin-bottom: 6px; }
    table, th, td { font-size: 11px; padding: 4px; }

    /* evitar cortes feos */
    .section, table, thead, tbody, tr, td, th { break-inside: avoid; page-break-inside: avoid; }
  }
</style>
</head>
<body>
<div class="container">

  <!-- Encabezado con logos -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
    <!-- Logo Teleton izquierda -->
    <img src="img/VTeleton_C_Negro_@2x.png" alt="Logo Teletón" style="height:60px;">
    <!-- Logo Ciclopit derecha -->
    <img src="img/LogoCiclopit_Sólido@4x.png" alt="Logo CICLOPIT" style="height:80px;">
  </div>

  <h2>ORDEN DE TRABAJO - CICLOPIT / TELETÓN</h2>
  <h4>Datos del Paciente - N° Ficha: 121212</h4>

  <!-- Datos del paciente -->
  <div class="section">
    <table>
      <tr>
        <td><b>Nombre</b><br/><input readonly type="text" value="Valentina"/></td>
        <td><b>Apellido Paterno</b><br/><input readonly type="text" value="Astudillo"/></td>
        <td><b>Apellido Materno</b><br/><input readonly type="text" value="Mandiola"/></td>
      </tr>
    </table>
  </div>

  <!-- Información General -->
  <div class="section">
    <h3>Información General</h3>
    <table>
      <tr>
        <td><b>N° OT</b><br/><input readonly type="text" value="2025-OT-00123"/></td>
        <td><b>Fecha de Mantenimiento</b><br/><input readonly type="date" value="2025-08-18"/></td>
        <td><b>Lugar de Atención</b><br/><input readonly type="text" value="Instituto Teletón - Santiago"/></td>
        <td>
          <b>Entrega Tríptico</b><br/>
          <span class="badge">✅ Sí</span>
        </td>
      </tr>
    </table>
  </div>

  <!-- Voluntarios -->
  <div class="section">
    <h3>Voluntarios Asignados</h3>
    <table>
      <thead>
        <tr>
          <th>Nombre Completo</th>
          <th>RUN</th>
          <th>Rol</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input readonly type="text" value="César Jiménez"/></td>
          <td><input readonly type="text" value="12.345.678-9"/></td>
          <td><input readonly type="text" value="Voluntario CICLOPIT"/></td>
        </tr>
        <tr>
          <td><input readonly type="text" value="María López"/></td>
          <td><input readonly type="text" value="9.876.543-2"/></td>
          <td><input readonly type="text" value="Voluntario CICLOPIT"/></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Ayudas Técnicas -->
  <div class="section">
    <h3 class="title-inline">
      Ayudas Técnicas Intervenidas
    </h3>
    <textarea readonly>Cambio de rueda derecha de silla de ruedas por desgaste. Se realizó revisión general y ajuste de la estructura.</textarea>

    <h4 style="margin-top:10px;">Detalle de Ayuda Técnica</h4>
    <table>
      <thead>
        <tr>
          <th>Tipo de Ayuda Técnica</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Tamaño</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input readonly type="text" value="Silla de Ruedas"/></td>
          <td><input readonly type="text" value="AWM"/></td>
          <td><input readonly type="text" value="Amarilla Convencional"/></td>
          <td><input readonly type="text" value="Chica"/></td>
        </tr>
      </tbody>
    </table>

    <h4 style="margin-top:10px;">Repuestos Cambiados</h4>
    <table>
      <thead>
        <tr>
          <th>Repuesto</th>
          <th>Cantidad</th>
          <th>Lado / Parte</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input readonly type="text" value="Rueda Grande"/></td>
          <td><input readonly type="text" value="1"/></td>
          <td><input readonly type="text" value="Derecha"/></td>
        </tr>
        <tr>
          <td><input readonly type="text" value="Apoya Pies"/></td>
          <td><input readonly type="text" value="2"/></td>
          <td><input readonly type="text" value="Ambos"/></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Tutor Responsable -->
  <div class="section">
    <h3>Tutor Responsable</h3>
    <table>
      <tr>
        <td><b>Nombre</b><br/><input readonly type="text" value="Juan Astudillo"/></td>
        <td><b>RUN</b><br/><input readonly type="text" value="11.111.111-1"/></td>
        <td><b>Correo</b><br/><input readonly type="email" value="juanastudillo@ejemplo.cl"/></td>
        <td>
          <b>Firma Digital </b><br/>
          <div class="firma-wrap">
            <canvas class="firma-box" id="firma"></canvas>
            <div class="firma-actions">
              <button class="btn-sm" id="limpiarFirma" type="button">Limpiar</button>
            </div>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <small>*Doy fe que las asistencias técnicas detalladas han sido realizadas conforme a los estándares del programa CICLOPIT por los voluntarios registrados. Confirmo haber recibido el servicio técnico y que los dispositivos se encuentran en condiciones funcionales al momento de la entrega.*</small>

  <!-- Botones -->
  <div class="btns">
    <button class="btn btn-print" onclick="window.print()">Imprimir / Guardar como PDF</button>
    <button class="btn btn-close" onclick="if(confirm('¿Deseas volver a la página de inicio?')){ window.location.href='http://localhost:21303/4125835077117191807/index.html#/screens/f74e9ab9-e5e5-4014-a02a-b4700b3846f1'; }">Volver</button>
  </div>
</div>

<script>
/* Firma en canvas (editable) */
(function(){
  const canvas = document.getElementById('firma');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  let drawing = false, lastX = 0, lastY = 0;

  function resizeCanvas() {
    const data = canvas.toDataURL();
    const img = new Image();
    img.onload = function() {
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    };
    img.src = data;
  }
  function initSize() {
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
  }
  initSize();
  window.addEventListener('resize', resizeCanvas);

  ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.lineWidth = 2;

  function getPos(e){
    const r = canvas.getBoundingClientRect();
    if (e.touches && e.touches[0]) {
      return { x: e.touches[0].clientX - r.left, y: e.touches[0].clientY - r.top };
    } else {
      return { x: e.clientX - r.left, y: e.clientY - r.top };
    }
  }
  function start(e){ drawing = true; const p = getPos(e); lastX = p.x; lastY = p.y; e.preventDefault();}
  function move(e){ if(!drawing) return; const p = getPos(e); ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(p.x, p.y); ctx.stroke(); lastX=p.x; lastY=p.y; e.preventDefault();}
  function end(){ drawing=false; }

  canvas.addEventListener('mousedown', start);
  canvas.addEventListener('mousemove', move);
  window.addEventListener('mouseup', end);
  canvas.addEventListener('touchstart', start, {passive:false});
  canvas.addEventListener('touchmove', move, {passive:false});
  canvas.addEventListener('touchend', end);

  const limpiar = document.getElementById('limpiarFirma');
  if (limpiar) limpiar.addEventListener('click', ()=>ctx.clearRect(0,0,canvas.width,canvas.height));
})();
</script>
</body>
</html>


